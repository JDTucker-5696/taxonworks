// j is an alias for escape_javascript
var html;
$("#find_item").mx_spinner('show');
html = $('<%= j(render(partial: 'result_list',
                       locals:  {otus: @otus})) %>');
$("#show_list").html(html);
$("#find_item").mx_spinner('hide');
$("body").mx_spinner('hide');

var paging;
paging = $('<%= j(render(partial: 'paging_data')) %>');
$("#paging_span").html(paging);

var message, otus_count, feature_collection;
message = $('<%= 'No otus found.' if @otus.count == 0 %>').selector;
if (message.length == 0) {
  otus_count = $('<%= @otus.total_count.to_s %>').selector;
  $("#result_span").text(otus_count);
}
else {
  $("#result_span").text(message);
}

result_collection = <%=
  Gis::GeoJSON.feature_collection(Georeference.joins(:collection_objects).where(collection_objects: {id: @otus.map(&:collection_objects).flatten.pluck(:id).uniq})).to_json.html_safe
%>;
if (result_collection) {
  if ($("#show_map").attr("hidden") != "hidden") {
    TW.vendor.lib.google.maps.loadGoogleMapsAPI().then(resolve = > {
      result_map = TW.vendor.lib.google.maps.initializeMap('simple_map_canvas', result_collection);
  })
    ;
  }
}

