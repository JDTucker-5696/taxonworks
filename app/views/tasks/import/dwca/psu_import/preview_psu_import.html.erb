<h2> Penn State Import Preview (This isn't really a 'Preview')</h2>

<p> Import includes <%= @result.count -%> records. </p>

<p> To complete this import, select the file again and click create:
  <%= form_tag do_psu_import_path, multipart: true do -%>
      <%= file_field_tag :file -%>
      <%= submit_tag 'Do' -%>
  <% end %>
</p>

<p><span style='color:green'>Green</span> lines will be imported. If there are soft validation errors
  they will appear below the green line in <span style="color:brown">brown</span>.
  <span style="color:red">Red</span> lines will not be imported and are followed by a list of the associated errors.
</p>

<%= ap(@result).html_safe %>
<ol>

  <% @result.keys do |kee| %>
      <% result_row = @result[kee] -%>
      <% if result_row[:err].empty? -%>
          <%= content_tag(:li, result_row[:row], class: 'green') -%>
          <% unless result_row[:warn].empty? %>
              <% result_row[:warn].each do |warning| %>
                  <ul><%= content_tag(:li, warning, class: 'brown') -%></ul>
              <% end %>
          <% end %>
      <% else %>
          <% result_row[:err].each do |error| %>
              <ul><%= content_tag(:li, error, class: 'red') -%></ul>
          <% end %>
      <% end %>
  <% end %>
</ol>
