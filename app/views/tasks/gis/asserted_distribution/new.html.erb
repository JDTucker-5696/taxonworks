<%= render(partial: 'layouts/map_header') -%>

<h1 class="task_header">Task: New Asserted Distribution by Map</h1>

<div class="flexbox">
  <div class="item item1">

    <%= form_for(@asserted_distribution, url: create_asserted_distribution_task_path, html: {id: 'new_asserted_distribution_from_map_form'}) do |f| %>

      <div class="inline_fields"> 
        <div class="field">
          <%= f.label :otu_id, 'OTU:' %>
          <br>

          <%= render(
            'workbench/elements/forms/ajax_select',
            controller: '/otus',
            object: 'asserted_distribution',
            method: 'otu_id',
            tag_id: 'otu_id_for_asserted_distribution',
            display: otu_tag(@asserted_distribution.otu),
            size: 40
          ) %>

        <%= lock_tag(@locks, :asserted_distribution, :otu_id) -%>
        <%= link_to('back', otu_path(@asserted_distribution.otu)) if @asserted_distribution.otu %>
        </div>

        <span id="sourceError" class="warning"></span>

        <%= f.fields_for :origin_citation, @asserted_distribution.origin_citation do |s| -%>
          <div class="field">
            <%= s.label :source %>
            <br>
            <%= render( 'workbench/elements/forms/ajax_select',
                       controller: '/sources',
                       related_object: @asserted_distribution.source,
                       object: 'asserted_distribution[origin_citation_attributes]',
                       method: 'source_id',
                       fields_for_object: s, 
                       tag_id: 'source_id_for_original_citation_asserted_distribution',
                       size: '50%',
                       display: source_tag(@asserted_distribution.origin_citation.source)
                      ) 
                    %>

                  <%= lock_tag(@locks, :asserted_distribution, :source_id) -%>
          </div>
      </div>
    <% end %>

    <div id="choices"><em> Click a point on the map to generate choices. </em></div>    
    <%= text_field_tag(:latitude) -%>
    <%= text_field_tag(:longitude) -%>
  <% end %>

  <br class="clear_both">
  
  </div>

  <div class="item item2">
    <div id="feature_collection" data-otu="<%= @asserted_distribution.otu %>"></div>
    <div id="new_asserted_distribution_map_canvas" style="width: 512px; height: 512px"></div>
    <span id="map_coords"></span>
  </div>
</div>

<div class="item item1">
  <%= render(partial: 'brief_list', locals: {otu: @asserted_distribution.otu}) if @asserted_distribution.otu -%>
</div>
