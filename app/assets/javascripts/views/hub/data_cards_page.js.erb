$(document).ready(function() {
  if($("#data_cards").length) {
    initDataCardsPage();
  }
});

function initDataCardsPage() {

  var 
  core = new CarrouselData("Core",99,1),	
  supporting = new CarrouselData("Supporting",99,2),	
  annotations = new CarrouselData("Annotations",99,1);

  [core, supporting, annotations].forEach(function(element) {
    element.addFilter("data-category-collecting_event");
    element.addFilter("data-category-Taxon_name");
    element.addFilter("data-category-source");
    element.addFilter("data-category-collection_object");
    element.addFilter("data-category-biology");
    element.filterChilds();
  });


  function changeAllSectionsFilter() {
    [core, supporting, annotations].forEach(function(element) {
      element.resetFilters();
      element.filterChilds();
      $('.reset-all-filters').fadeOut(0);
    });
  }

  $('.data_card').mousedown(function(event) {
  	if((event.which) == 1) {
     location.href = $(this).children("a").attr('href');
   }
 });    

  $('#filter [data-filter-category]').on('click', function() {
    var
    elementFilter = $(this).attr('data-filter-category');
    if(elementFilter === "reset") {
      changeAllSectionsFilter();
    }
    else {
      [core, supporting, annotations].forEach(function(element) {
        element.changeFilter("data-category-"+ elementFilter);
      });
    }
    if(core.empty() && supporting.empty() && annotations.empty()) {
      $('[data-section="Supporting"] .reset-all-filters').fadeIn();
    }
    else {
      $('.reset-all-filters').fadeOut(0);
    }    
  }); 

  $('.reset-all-filters').on('click', function() {
    changeAllSectionsFilter(); 
  });


  $('.data_card div[data-category-collecting_event="true"]').append("<img src='<%= asset_path('geo_location.svg') %>'/>");
  $('.data_card div[data-category-taxon_name="true"]').append("<img src='<%= asset_path('new.svg') %>'/>");
  $('.data_card div[data-category-collection_object="true"]').append("<img src='<%= asset_path('picking.svg') %>'/>");
  $('.data_card div[data-category-source="true"]').append("<img src='<%= asset_path('book.svg') %>'/>");   

}