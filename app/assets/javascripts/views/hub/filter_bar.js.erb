$(document).ready(function() {
  if($("#filter").length) {
    initFilterBar();
  }
});

function initFilterBar() {
	$('[data-filter-category="taxon_name"]').prepend('<img src="<%= asset_path("new.svg") %>"/>');
	$('[data-filter-category="source"]').prepend('<img src="<%= asset_path("book.svg") %>"/>');
	$('[data-filter-category="collection_object"]').prepend('<img src="<%= asset_path("picking.svg") %>"/>');
  $('[data-filter-category="collecting_event"]').prepend('<img src="<%= asset_path("geo_location.svg") %>"/>'); 
  $('[data-filter-category="biology"]').prepend('<img src="<%= asset_path("biology.svg") %>"/>'); 

  function deactivateBackgroundColorLink(selector) {
    $(selector).removeClass("activated");
  }

  function activateBackgroundColorLink(selector) {
    $(selector).addClass("activated");
  }

  function changeBackgroundColorLink(selector) {
    if ($(selector).hasClass("activated")) {
      deactivateBackgroundColorLink(selector);
    }
    else {
      activateBackgroundColorLink(selector);
    }
  }
  $('#filter [data-filter-category]').on('click', function() {
    changeBackgroundColorLink('[data-filter-category="'+ $(this).attr("data-filter-category") +'"]');
  }); 

  $('#filter .filter-category [data-filter-category]').on('click', function() {
    var hasClass = $(this).hasClass("activated");
    deactivateBackgroundColorLink('.filter-category [data-filter-category]');
    if(hasClass) {
      $('.status-name').text($(this).data("filter-category"));
      $('.status-name').css("box-shadow", "inset 0px 0px 3px 0px " + $(this).css("background-color"));
      $('.status-name').css("opacity", 0.8);
      activateBackgroundColorLink('[data-filter-category="'+ $(this).attr("data-filter-category") +'"]');      
    }
  }); 


  //Add classes for cards when the filter status is active
  $('#filter .switch input').on('click', function() {
    if($(this).is(':checked')) {
      $('.filter-category').css('display','flex');
      $('.filter-category').hide();
      $('.filter-category').fadeIn(250);
      $('.filter_data').each(function() {
        if($(this).children().length > 0) {
          $(this).addClass("categories");
        }
        else {
          $(this).addClass("status");
        }
      });      
    }
    else {
      $('.filter-category').fadeOut(250);
      $('.filter_data').each(function() {
        $(this).removeClass("categories");
        $(this).removeClass("status");
      });       
    }
  }); 

  function restartFilterStatus() {
      $('.status-name').css("box-shadow","inset 0px 1px 5px 0px #e5e5e5");
      $('.status-name').css("background-color", "#FCFCFC");
      $('.status-name').text("Status");
  }

  $('#filter [data-filter-category="reset"]').on('click', function() {
    restartFilterStatus();   
    deactivateBackgroundColorLink('[data-filter-category]');
  });     

  $('.reset-all-filters').on('click', function() {
    restartFilterStatus();  
    deactivateBackgroundColorLink('[data-filter-category]');
  }); 

}
