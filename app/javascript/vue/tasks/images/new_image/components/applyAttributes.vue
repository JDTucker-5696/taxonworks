<template>
  <div class="panel content">
    <h2>Use the options below to build attributions and depictions, then apply it to your images.</h2>
    <div class="flexbox">
      <div class="separate-right">
        <div class="horizontal-left-content separate-bottom">
          <input
            class="input-apply"
            disabled="true"
            :value="showPeopleAndLicense"
            type="text">
          <button
            type="button"
            :disabled="!validateAttr || !imagesCreated"
            class="button normal-input button-submit separate-left"
            @click="applyAttr">
            Apply
          </button>
        </div>
        <div class="horizontal-left-content">
          <input
            class="input-apply"
            disabled="true"
            :value="objectsForDepictions"
            type="text">
          <button
            type="button"
            :disabled="!(validateDepic || (createNewCO && validateSqedObject) && imagesCreated)"
            class="button normal-input button-submit separate-left"
            @click="applyDepic">
            Apply
          </button>
        </div>
      </div>
      <button 
        class="button normal-input button-submit item button-apply-both "
        type="button"
        :disabled="!((validateDepic || (createNewCO && validateSqedObject) && validateAttr) && imagesCreated)"
        @click="applyAttr(); applyDepic()">
        Apply both
      </button>
    </div>
  </div>
</template>

<script>

import { GetterNames } from '../store/getters/getters.js'
import { ActionNames } from '../store/actions/actions.js'
import validateSqed from '../helpers/validateSqed'

export default {
  computed: {
    validateSqedObject() {
      return validateSqed(this.getSqed)
    },
    createNewCO() {
      return this.$store.getters[GetterNames.GetNewCOForSqed]
    },
    getSqed() {
      return this.$store.getters[GetterNames.GetSqed]
    },
    imagesCreated() {
      return this.$store.getters[GetterNames.GetImagesCreated].length > 0
    },
    validateDepic() {
      return (this.$store.getters[GetterNames.GetObjectsForDepictions].length > 0)
    },
    validateAttr() {
      return (this.imagesBy.length > 0 || this.license.length)
    },
    authors() {
      return this.$store.getters[GetterNames.GetPeople].authors
    },
    editors() {
      return this.$store.getters[GetterNames.GetPeople].editors
    },
    owners() {
      return this.$store.getters[GetterNames.GetPeople].owners
    },
    copyrightHolder() {
      return this.$store.getters[GetterNames.GetPeople].copyrightHolder
    },
    license() {
      let tmp = this.$store.getters[GetterNames.GetLicense]
      return (tmp ? `License: ${tmp}` : '')
    },
    imagesBy() {
      let people = [].concat(this.getNames(this.authors), 
        this.getNames(this.editors), 
        this.getNames(this.owners), 
        this.getNames(this.copyrightHolder))
      return people.length ? `Image(s) by ${people.join('; ')}.` : ''
    },
    showPeopleAndLicense() {
      if(this.imagesBy.length || this.license.length)
        return `${this.imagesBy}${this.imagesBy.length > 0 ? ` ${this.license}` : this.license}`
      return 'The attribution summary will be displayed here when defined.'
    },
    objectsForDepictions() {
      if(this.createNewCO) { return 'A depiction summary will be displayed here when defined. Otherwise a new collection object will be created for each image.' }
      
      let tmp = this.$store.getters[GetterNames.GetObjectsForDepictions].map(item => {
        return item.label
      })
      return tmp.length ? `Depicts some: ${tmp.join(', ')}` : 'A depiction summary will be displayed here when defined.'
    }
  },
  methods: {
    getNames(list) {
      let ppl = list.map(item => {
        if(item.hasOwnProperty('label')) {
          return item.label
        }
        else if(item.hasOwnProperty('person_attributes'))
          return `${item.person_attributes.last_name}, ${item.person_attributes.first_name}`
        else 
          return `${item.last_name}, ${item.first_name}`
      })
      return ppl
    },
    applyAttr() {
      this.$store.dispatch(ActionNames.ApplyAttributions)
    },
    applyDepic() {
      this.$store.dispatch(ActionNames.ApplyDepictions)
    }
  }
}
</script>

<style scoped>
  .input-apply {
    width: 100%;
  }

  .button-apply-both {
    height: 69px;
  }
</style>
